steps:
- label: Test E
  group: a
  agents:
    queue: gpu_1_queue
  commands:
  - echo "Test E"
  - echo "Test E.F"
  soft_fail: false
  plugins:
  - image: public.ecr.aws/q9t5s3a7/vllm-ci-premerge-repo:123
    always_pull: true
    propagate_environment: true
    gpus: all
    environment:
    - VLLM_USAGE_SOURCE=ci-test
    - NCCL_CUMEM_HOST_ENABLE=0
    - HF_HOME=/fsx/hf_cache
    - HF_TOKEN
    - CODECOV_TOKEN
    volumes:
    - /dev/shm:/dev/shm
    - /fsx/hf_cache:/fsx/hf_cache
- label: Test F
  group: a
  agents:
    queue: cpu_queue_premerge_us_east_1
  commands:
  - echo "Test F"
  soft_fail: false
  plugins:
  - image: public.ecr.aws/q9t5s3a7/vllm-ci-premerge-repo:123
    always_pull: true
    propagate_environment: true
    gpus: all
    environment:
    - VLLM_USAGE_SOURCE=ci-test
    - NCCL_CUMEM_HOST_ENABLE=0
    - HF_HOME=/fsx/hf_cache
    - HF_TOKEN
    - CODECOV_TOKEN
    volumes:
    - /dev/shm:/dev/shm
    - /fsx/hf_cache:/fsx/hf_cache
- label: Test G
  group: a
  agents:
    queue: gpu_1_queue
  commands:
  - echo "Test G"
  - echo "Test G.H"
  soft_fail: false
  plugins:
  - image: public.ecr.aws/q9t5s3a7/vllm-ci-premerge-repo:123
    always_pull: true
    propagate_environment: true
    gpus: all
    environment:
    - VLLM_USAGE_SOURCE=ci-test
    - NCCL_CUMEM_HOST_ENABLE=0
    - HF_HOME=/fsx/hf_cache
    - HF_TOKEN
    - CODECOV_TOKEN
    volumes:
    - /dev/shm:/dev/shm
    - /fsx/hf_cache:/fsx/hf_cache
- label: Test H
  group: a
  agents:
    queue: gpu_4_queue
  commands:
  - echo "Test H.I"
  - echo "Test H.J"
  soft_fail: false
  plugins:
  - image: public.ecr.aws/q9t5s3a7/vllm-ci-premerge-repo:123
    always_pull: true
    propagate_environment: true
    gpus: all
    environment:
    - VLLM_USAGE_SOURCE=ci-test
    - NCCL_CUMEM_HOST_ENABLE=0
    - HF_HOME=/fsx/hf_cache
    - HF_TOKEN
    - CODECOV_TOKEN
    volumes:
    - /dev/shm:/dev/shm
    - /fsx/hf_cache:/fsx/hf_cache
- label: Test A
  group: bb
  agents:
    queue: gpu_1_queue
  commands:
  - echo "Test A"
  - echo "Test A.B"
  soft_fail: false
  plugins:
  - image: public.ecr.aws/q9t5s3a7/vllm-ci-premerge-repo:123
    always_pull: true
    propagate_environment: true
    gpus: all
    environment:
    - VLLM_USAGE_SOURCE=ci-test
    - NCCL_CUMEM_HOST_ENABLE=0
    - HF_HOME=/fsx/hf_cache
    - HF_TOKEN
    - CODECOV_TOKEN
    volumes:
    - /dev/shm:/dev/shm
    - /fsx/hf_cache:/fsx/hf_cache
- label: Test B
  group: bb
  agents:
    queue: cpu_queue_premerge_us_east_1
  commands:
  - echo "Test B"
  soft_fail: false
  plugins:
  - image: public.ecr.aws/q9t5s3a7/vllm-ci-premerge-repo:123
    always_pull: true
    propagate_environment: true
    gpus: all
    environment:
    - VLLM_USAGE_SOURCE=ci-test
    - NCCL_CUMEM_HOST_ENABLE=0
    - HF_HOME=/fsx/hf_cache
    - HF_TOKEN
    - CODECOV_TOKEN
    volumes:
    - /dev/shm:/dev/shm
    - /fsx/hf_cache:/fsx/hf_cache
- label: Test C
  group: bb
  agents:
    queue: gpu_1_queue
  commands:
  - echo "Test C"
  - echo "Test C.D"
  soft_fail: false
  plugins:
  - image: public.ecr.aws/q9t5s3a7/vllm-ci-premerge-repo:123
    always_pull: true
    propagate_environment: true
    gpus: all
    environment:
    - VLLM_USAGE_SOURCE=ci-test
    - NCCL_CUMEM_HOST_ENABLE=0
    - HF_HOME=/fsx/hf_cache
    - HF_TOKEN
    - CODECOV_TOKEN
    volumes:
    - /dev/shm:/dev/shm
    - /fsx/hf_cache:/fsx/hf_cache
- label: Test D
  group: bb
  agents:
    queue: gpu_4_queue
  commands:
  - echo "Test D.A"
  - echo "Test D.B"
  soft_fail: false
  plugins:
  - image: public.ecr.aws/q9t5s3a7/vllm-ci-premerge-repo:123
    always_pull: true
    propagate_environment: true
    gpus: all
    environment:
    - VLLM_USAGE_SOURCE=ci-test
    - NCCL_CUMEM_HOST_ENABLE=0
    - HF_HOME=/fsx/hf_cache
    - HF_TOKEN
    - CODECOV_TOKEN
    volumes:
    - /dev/shm:/dev/shm
    - /fsx/hf_cache:/fsx/hf_cache
